# chapter 2-1

### [콘서트 예약] 시나리오 선정

chapter 1에서 TDD와 클린 아키텍처를 경험하고, 처음이자 마지막으로 항해 과정에서 함께할 서비스 선정 시간을 가지게 되었습니다.

그렇게 저희 조가 선택한 프로젝트는 바로 **[콘서트 예약 시스템].** 해당 프로젝트의 가장 큰 핵심은 바로 ‘대기열 시스템’을 구축하는 것이었습니다.

### 제대로 된 설계를 해보자

해당 주차 에서는 ‘제대로 된 설계’를 목표로 시퀀스 다이어그램, ERD, API 명세서 등을 작성함으로서 생각으로 그친 내용들을 시각화하는 작업들을 하였습니다.

`mermaid` 를 사용하여 제법 그럴 싸한 차트와 `Git Project` 를 통해 3주간의 기본 서버 구축을 위한 마일스톤 설정을 할 수 있었습니다.

이전까지 현업에서는 제대로 된 설계를 진행하거나, 문서등을 받아본 경험이 적었고, 이로 인해 코드 분석에 많은 시간을 쏟았었었는데, 이렇게 시각화 하고 보니 이후에 어떻게 구현해야할지 좀 더 파악이 잘되는 느낌이었습니다.

# chapter 2-2

### 비즈니스 로직 구현과 유닛, 통합 테스트 진행

chapter 2-2 부터 본격적으로 이전에 설계 하였던 flowchart,erd, api 명세서를 기반으로 직접 코드로 구현하는 시간을 가지게 되었습니다.

Spring과 JPA에 아직 익숙치 않다보니 코드 구현에 많이 어려움을 느꼈다고 생각했는데, 지나고보니 직접 타이핑하는 시간은 생각보다 적었던 것 같습니다. 오히려 고민하는 시간이 더 많았다고 해야하나,, 코치님들께서 항상 강조하시는 단방향 흐름을 지키기 위한 아키텍쳐에 대한 고민, 도메인 관점에서 어떤 책임을 가지고있는지 분석하는 등 고민하는 시간이 더 많았던 것 같습니다.

그리고 고민하는 시간이 길어질 수록 이러한 부분까지 설계를 좀 더 꼼꼼히 진행할 껄! 이라는 후회도 많이 남았습니다.

해당 주차 에서는 기능 개발을 완료 해야한다는 목표가 설정되어있어 테스트를 소홀히 진행 하였는데, 이 때문에 Facade로 여러 도메인 서비스를 조합하는 과정에서 사소한 에러를 계속해서 수정해서 작업이 더 지연되었었던 기억이 납니다.

하지만 그만큼 TDD의 중요성을 뼈저리게 느낄 수 있었고, 완벽하지는 않더라도 모든 기능을 구현해내었다는 것에 성취감을 느낄 수 있었던 뜻 깊은 파트 였습니다.

# chapter 2-3

### Globle Exception Handler 추가

@RestControllerAdvice 를 사용하여 글로벌 예외 핸들러를 통해 예외 처리를 관리하고, ErrorCode 를 정의하여 나름의 체계를 구축하여 처리 하였다고 생각했습니다. 만..멘토링 이후 ErrorCode 의 의미없는 라벨링과 HttpStatusCode에 의존적인 부분을 벗어나야한다는 생각이 들게되어 고민하고 리팩토링하는 시간을 가져야할 것 같습니다.

### Filter와 Interceptor

필터와 인터셉터의 사용을 위해서 servlet, spring 프레임워크의 동작방식에 대해서 한번더 공부할 수 있는 시간이었기때문에 아주 유의미한 시간이었던 것 같습니다.

제 어플리케이션에서는 JWT로 발급한 토큰에 대한 검증을 Filter에서, 이후 Interceptor에서는 토큰이 유효한지에 대한 검증과 로깅에 사용하게 되었습니다.

### **정상적으로 구동되는 서버 완성 및 통합 테스트 작성**

이전에 미흡했던 통합테스트를 정말 열심히 작성하며 비즈니스 로직 오류를 잡아가며 완성할 수 있던 시간이었습니다. 통합 테스트코드를 작성해보며 트랜잭션 경계에 대한 이해도가 많이 떨어지는 것을 느꼈던 시간이었습니다.

### 동시성 제어와 통합테스트

동시성 제어로 포인트 충전,좌석 예약을 낙관적 락을 이용해 해결을 하고 통합테스트를 진행하였습니다. 잔액 충전의 경우에는트랜잭션 충돌 가능성이 낮고 충돌 시 재시도할 수 있는 구조이므로 낙관적 락이 맞다 생각하여 진행하였고, 좌석예약은 다시 생각해보니 한정된 자원을 여러 사용자가 동시에 경쟁하는 상황이다보니 좀 더 데이터 무결성을 보장하는 비관적 락이 맞는 것 같아 좀 더 고민하고 공부해서 적용시켜 보고자합니다.
